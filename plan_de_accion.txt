# Plan de Acción: Portal de Cliente

Este plan describe los pasos para implementar las funcionalidades del portal de cliente en el proyecto `FacturasSRI`.

## Fase 1: Backend (API Endpoints)

El objetivo es crear o adaptar los endpoints de la API para que el cliente autenticado pueda consumir su propia información. Se debe asegurar que un cliente solo pueda ver sus propios datos.

1.  **Dashboard del Cliente:**
    *   Crear un nuevo endpoint `GET /api/cliente/dashboard` que devuelva estadísticas relevantes para el cliente logueado (total pendiente, total pagado, número de facturas pendientes).
    *   Crear un método en `IDashboardService.cs` y su implementación para obtener estas estadísticas.

2.  **Facturas del Cliente:**
    *   Modificar/crear el endpoint `GET /api/invoices/cliente` para que devuelva una lista paginada de las facturas del cliente autenticado. Se puede filtrar por estado (pagada, pendiente).
    *   Asegurar que `IInvoiceService.cs` tenga un método como `GetInvoicesByClientIdAsync(int clienteId, ...)`.

3.  **Notas de Crédito del Cliente:**
    *   Crear un endpoint `GET /api/creditnotes/cliente` que devuelva las notas de crédito del cliente autenticado.
    *   Añadir el método correspondiente en `ICreditNoteService.cs`.

4.  **Pagos del Cliente:**
    *   Crear un endpoint `GET /api/cobros/cliente` que devuelva el historial de pagos (cobros) realizados por el cliente autenticado.
    *   Añadir el método correspondiente en `ICobroService.cs`.

## Fase 2: Frontend (Blazor - FacturasSRI.Web)

Se crearán las vistas y componentes necesarios en el proyecto Blazor Server.

1.  **Layout y Navegación para Cliente:**
    *   Crear un layout específico para el cliente (`ClienteLayout.razor`) que herede del layout principal si es necesario.
    *   Modificar el `NavMenu.razor` para mostrar los nuevos enlaces del portal del cliente *solo si el usuario tiene el rol de "Cliente"*. Se usará el componente `<AuthorizeView>`.
        *   Inicio (Cliente)
        *   Mis Facturas
        *   Mis Notas de Crédito
        *   Mis Pagos

2.  **Creación de Páginas (Componentes Razor):**
    *   **Página de Inicio del Cliente (`ClienteDashboard.razor`):**
        *   Ruta: `/cliente/dashboard`
        *   Consumirá el endpoint `/api/cliente/dashboard` para mostrar las tarjetas con estadísticas.
    *   **Página de Facturas (`ClienteFacturas.razor`):**
        *   Ruta: `/cliente/facturas`
        *   Tendrá pestañas o filtros para "Pendientes de Pago" e "Historial".
        *   Consumirá el endpoint `/api/invoices/cliente`.
        *   Incluirá botones para ver detalle y descargar (PDF/XML).
    *   **Página de Notas de Crédito (`ClienteNotasCredito.razor`):**
        *   Ruta: `/cliente/notas-credito`
        *   Consumirá el endpoint `/api/creditnotes/cliente`.
        *   Mostrará una tabla con las notas de crédito.
    *   **Página de Pagos (`ClientePagos.razor`):**
        *   Ruta: `/cliente/pagos`
        *   Consumirá el endpoint `/api/cobros/cliente` para mostrar el historial de pagos.

3.  **Seguridad en el Frontend:**
    *   Aplicar el atributo `[Authorize(Roles = "Cliente")]` a todas las nuevas páginas del portal de cliente para asegurar que solo los clientes puedan acceder.
    *   Configurar la redirección para que, después de hacer login, los clientes sean dirigidos a su dashboard (`/cliente/dashboard`).

## Fase 3: Lógica y Servicios del Cliente

Se implementará la lógica de negocio en los servicios del frontend para conectar con la API.

1.  **Crear Servicios de Frontend:**
    *   Crear una clase `ClientePortalService.cs` en `FacturasSRI.Web/Services` que se encargue de hacer las llamadas a los nuevos endpoints de la API.
    *   Inyectar este servicio en los componentes Razor correspondientes.

2.  **Implementar la Descarga de Documentos:**
    *   Crear la lógica necesaria para que los botones de descarga en la lista de facturas y notas de crédito llamen a los endpoints existentes (si los hay) o crear nuevos para obtener los archivos PDF y XML.