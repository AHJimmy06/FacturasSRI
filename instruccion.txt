Actúa como un Arquitecto de Software experto en .NET 8 y Clean Architecture. Estoy trabajando en el módulo HU-15: Gestión de Pagos (Cuentas por Cobrar) de un sistema de facturación electrónica (FacturasSRI).

CONTEXTO ACTUAL:
1. Tengo una entidad 'Factura' y una entidad 'CuentaPorCobrar'.
2. Actualmente, al crear una factura en 'InvoiceService', el sistema crea automáticamente un registro en 'CuentaPorCobrar' con 'SaldoPendiente' igual al 'Total' y 'Pagada = false'.
3. ESTO ES UN PROBLEMA: No distingue entre ventas al "Contado" (que deberían nacer pagadas o con saldo 0) y ventas a "Crédito".
4. Además, necesito registrar abonos parciales a futuro para las facturas a crédito, y actualmente no tengo una entidad para guardar el historial de pagos/cobros.

TAREA 1: ANÁLISIS DE DOMINIO Y BASE DE DATOS
Por favor, analiza el archivo `FacturasSRI.Domain\Entities\CuentaPorCobrar.cs` y la estructura general.
- Dime si necesito agregar una nueva entidad (ej. `Cobro` o `HistorialPagos`) relacionada con `CuentaPorCobrar` para registrar los pagos individuales (Fecha, Monto, FormaPago, Referencia).
- Dime qué campos debo agregar o modificar en `CuentaPorCobrar` o `Factura` para soportar la distinción entre Contado/Crédito.

TAREA 2: IMPLEMENTACIÓN (DTOs y Lógica)
Una vez definido el dominio, genera el código para:
1. Las nuevas Entidades de Dominio necesarias (o modificaciones a las existentes).
2. Actualizar `CreateInvoiceDto.cs` para incluir:
   - `bool EsCredito` (o `FormaPago` enum).
   - `int DiasCredito` (opcional).
   - `decimal MontoAbonoInicial` (por si pagan una parte al contado y el resto a crédito).
3. Actualizar la lógica en `InvoiceService.cs` (método `CrearFacturaPendienteAsync`) para:
   - Si es Contado: Crear la `CuentaPorCobrar` con Saldo 0 y Pagada = true, y registrar automáticamente el cobro total.
   - Si es Crédito: Crear la `CuentaPorCobrar` con el Saldo total y definir la Fecha de Vencimiento correcta.

Por favor, sé cuidadoso con Entity Framework Core y las relaciones entre tablas.

Y considerar que para migrar necesitas:

Ir a: C:\Users\THINKPAD\Desktop\FacturasSRI\FacturasSRI.Infrastructure, y ejecutar dotnet ef database update

PERO MAS IMPORTANTE Y SIEMPRE RECUERDA ESTO:

Es un proyecto universitario solo de 4to semestre. ESTA CONECTADO AL SRI CON AMBIENTE DE PRUEBAS Y SIEMPRE SERA AMBIENTE DE PRUEBAS. Nunca olvides esto por favor