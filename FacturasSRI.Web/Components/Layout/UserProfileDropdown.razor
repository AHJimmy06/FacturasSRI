@inject CurrentUserState CurrentUser
@inject NavigationManager Navigation
@inject LocalStorageService LocalStorage
@using FacturasSRI.Web.Services

<div class="dropdown">
    <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
        <span class="user-profile-icon me-2">@UserInitials</span>
        <strong>@CurrentUser.FullName</strong>
    </a>
    <ul class="dropdown-menu text-small shadow" aria-labelledby="dropdownUser1">
        <li><a class="dropdown-item" href="#">Mi Perfil</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="#" @onclick="Logout" @onclick:preventDefault="true">Cerrar Sesi√≥n</a></li>
    </ul>
</div>

@code {
    private string UserInitials
    {
        get
        {
            if (string.IsNullOrEmpty(CurrentUser.FullName)) return "?";
            var parts = CurrentUser.FullName.Split(new[] { ' ' }, StringSplitOptions.RemoveEmptyEntries);
            if (parts.Length > 1)
            {
                return $"{parts[0][0]}{parts[1][0]}".ToUpper();
            }
            return parts[0].Length > 1 ? parts[0].Substring(0, 2).ToUpper() : parts[0].ToUpper();
        }
    }

    private async Task Logout()
    {
        CurrentUser.Logout();
        await LocalStorage.RemoveItemAsync("authToken");
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}